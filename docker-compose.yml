version: "3.9" # Use the latest version of Docker Compose

services:
  # FastAPI application
  fastapi:
    build:
      context: . # Current directory for the Dockerfile
    volumes:
      - .:/app # Mount the current directory to /app inside the container for live code changes
    ports:
      - "8000:8000" # Expose port 8000 on host and container
    environment:
      - DATABASE_URL=postgresql://postgres:postgres@db/moveo # Database URL for connection
    depends_on:
      - db # Ensure that the DB is up before the FastAPI app starts

  # PostgreSQL database
  db:
    image: postgres:13 # Use the official Postgres image
    volumes:
      - postgres_data:/var/lib/postgresql/data # Persist database data across restarts
    environment:
      - POSTGRES_USER=postgres # Set user
      - POSTGRES_PASSWORD=postgres # Set password
      - POSTGRES_DB=moveo # Set database name
    ports:
      - "5432:5432" # Expose PostgreSQL port (default 5432)

volumes:
  postgres_data: # Define a volume for PostgreSQL data persistence
